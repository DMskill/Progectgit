# Archive — 2025-08-14

Scope: локальная готовность проекта к прод-запуску, UX/SEO улучшения, базовая наблюдаемость/CI и инфраструктура Cloudflare.

## Ключевые итоги
- Локальный стек (DB/Backend/Frontend) стабилен, e2e/юнит тесты зелёные.
- Front ↔ Back: прокси `/api`, CSP, rewrites — устранены ошибки `ECONNREFUSED`.
- Контент/UX: hero i18n, блок безопасности (модалка), FAQ, комиссии, CTA-инфоблок.
- Пагинация: 50/стр., счётчик, пагинатор; серверная интеграция `/listings/paged` + безопасный фолбэк на старый эндпоинт.
- SEO/служебные: `robots.txt`, `sitemap.xml`, `/{locale}/terms`, `/{locale}/privacy`, общий футер.
- Backend: индексы Prisma под фильтры, `/health`.
- CI: GitHub Actions (lint/typecheck/tests + docker build).
- Домены: Cloudflare Registrar активирован; подготовлены инструкции DNS/SSL.

## Изменённые файлы (основное)
- Frontend
  - `src/app/[locale]/page.tsx` — интеграция серверной пагинации и синхронизация `?page=`.
  - `src/lib/api.ts` — `getListingsPaged` + фолбэк.
  - `src/app/robots.ts`, `src/app/sitemap.ts` — robots/sitemap.
  - `src/app/[locale]/terms/page.tsx`, `src/app/[locale]/privacy/page.tsx` — служебные страницы.
  - `src/app/[locale]/layout.tsx` — футер и `generateMetadata` для SEO.
- Backend
  - `src/listings/...` — добавлен `/listings/paged` (совместимо со старым `/listings`).
  - `src/health/...` — эндпоинт `/health`.
  - Prisma: индексы на `Listing`.
- CI: `.github/workflows/ci.yml`.

## Что осталось на прод-этап
1) Получить IPv4 сервера (Hetzner/Vultr и т.п.).
2) Cloudflare DNS:
   - A `@` → IPv4 (Proxied), CNAME `www` → `@` (Proxied).
   - SSL/TLS: Full(Strict), Always Use HTTPS, redirect `www` → root.
3) Прод-запуск:
   - `docker compose -f docker-compose.prod.yml up -d --build`
   - Проверки: `/` и `/api/health`, регистрация/логин/объявления/фильтры/пагинация.
4) После запуска:
   - SMTP (Resend/Postmark) — переменные в `backend/.env`.
   - Мониторинг: Sentry (front/back), uptime на `/` и `/api/health`.

## Важные ENV (прод)
Backend (`backend/.env`):
- `NODE_ENV=production`
- `PORT=3001`
- `JWT_SECRET=...`
- `DATABASE_URL=...`
- `CORS_ORIGINS=https://<ваш-домен>`
- `PUBLIC_API_URL=https://<ваш-домен>/api`
- `PUBLIC_APP_URL=https://<ваш-домен>`
- `SMTP_HOST/SMTP_PORT/SMTP_USER/SMTP_PASS` (опц.)

Frontend:
- `NEXT_PUBLIC_SITE_URL=https://<ваш-домен>`
- `NEXT_PUBLIC_E2E` — не задавать в проде.

## Решения по безопасности
- Rate limit на `/auth/*` (Throttler): register/login/profile/change-password/email-change.
- CSP актуализирован, фронт ходит через `/api`.

## Примечания
- Пагинация на фронте не зависит от наличия `/listings/paged` (есть фолбэк). Можно обновить бэк позже.
- Все изменения обратносуместимы для локального запуска и e2e. 